{% extends "base.html" %}
{% block title %}Мої плейлисти{% endblock %}
{% block content %}
<h1>Мої плейлисти</h1>

<p><a href="{{ url_for('add_playlist') }}">Додати новий плейлист</a></p>

<!-- Блок імпорту Spotify-плейлисту / альбому -->
<h2>Імпортувати з Spotify</h2>
<form method="POST" action="{{ url_for('import_spotify_playlist') }}">
    <input type="text" name="playlist_url" placeholder="Посилання на плейлист або альбом Spotify" required>
    <button type="submit">Імпортувати</button>
</form>

<hr>

{% if playlists %}
    {% for playlist in playlists %}
        <details>
            <summary>{{ playlist.name }} (Створено: {{ playlist.created_at.strftime('%Y-%m-%d') }})</summary>
            <div>
                {% if playlist.description %}
                    <p><strong>Опис:</strong> {{ playlist.description }}</p>
                {% else %}
                    <p><em>Опис відсутній</em></p>
                {% endif %}
                <form method="POST" action="{{ url_for('add_song_spotify', playlist_id=playlist.id) }}">
                    <input type="text" name="song_url" placeholder="Посилання на пісню Spotify" required>
                    <button type="submit">Додати пісню</button>
                </form>

                {% if playlist.songs %}
                    <ul>
                        {% for song in playlist.songs %}
                            <li>
                                <details>
                                    <summary>{{ song.name }} (<a href="{{ song.url }}" target="_blank">Слухати</a>)</summary>
                                    <div>
                                        {% if song.genres %}
                                            <p><strong>Жанри:</strong> {{ song.genres }}</p>
                                        {% else %}
                                            <p><em>Жанри відсутні</em></p>
                                        {% endif %}
                                        <p><strong>Популярність:</strong> {{ song.popularity if song.popularity is not none else 'Н/Д' }}</p>
                                        <p><strong>Длительность:</strong> {{ (song.duration_ms / 1000 / 60) | round(2) if song.duration_ms else 'Н/Д' }} мин</p>
                                        <p><strong>Явный контент:</strong> {{ 'Да' if song.explicit else 'Нет' }}</p>
                                        <p><strong>Дата выпуска:</strong> {{ song.release_date if song.release_date else 'Н/Д' }}</p>
                                        <form method="POST" action="{{ url_for('rate_song', song_id=song.id) }}">
                                            <label>Оцінка (1-10):</label>
                                            <input type="number" name="rating" min="1" max="10" value="{{ song.rating or '' }}">
                                            <button type="submit">Оцінити</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('add_note', song_id=song.id) }}">
                                            <label>Нотатка:</label>
                                            <input type="text" name="note" value="{{ song.notes or '' }}" placeholder="Нотатка">
                                            <button type="submit">Зберегти</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('delete_song', song_id=song.id) }}" style="display:inline;">
                                            <button type="submit" onclick="return confirm('Ви впевнені, що хочете видалити цю пісню?');">Видалити пісню</button>
                                        </form>
                                    </div>
                                </details>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>У цьому плейлисті поки немає пісень.</p>
                {% endif %}
                <p>
                    <a href="{{ url_for('edit_playlist', id=playlist.id) }}">Редагувати</a> |
                    <form method="POST" action="{{ url_for('delete_playlist', playlist_id=playlist.id) }}" style="display:inline;">
                        <button type="submit" onclick="return confirm('Ви впевнені, що хочете видалити цей плейлист? Усі пісні також буде видалено.');">Видалити плейлист</button>
                    </form>
                </p>
            </div>
        </details>
    {% endfor %}
{% else %}
    <p>У вас поки немає плейлистів.</p>
{% endif %}

<p><a href="{{ url_for('home') }}">На головну</a></p>
{% endblock %}